package com.r0adkll.deckbuilder.arch.data.features.preview

import com.google.gson.Gson
import com.jakewharton.rxrelay2.BehaviorRelay
import com.r0adkll.deckbuilder.arch.data.remote.model.ExpansionPreview
import com.r0adkll.deckbuilder.arch.domain.features.preview.PreviewRepository
import io.reactivex.Observable
import java.io.IOException


class TestPreviewRepository : PreviewRepository {

    private val gson = Gson()
    private val testingPreviewJson = "{\"version\":2,\"expiresAt\":\"2018-12-02T12:00Z\",\"code\":\"sm8\",\"preview\":{\"logo\":{\"url\":\"https://images.pokemontcg.io/sm8/logo.png\",\"margins\":{\"top\":8}},\"title\":\"Lost Thunder is here!\",\"description\":\"Over 210 cards! \\n7 powerful Prism Star cards, including 3 Stadiums\\n12 Pok√©mon GX and 4 Ultra Beasts\\nMore than 20 Trainer cards\",\"textColor\":\"#FFFFFF\",\"background\":[{\"source\":{\"type\":\"color\",\"value\":\"#000000\"}},{\"source\":{\"type\":\"base64\",\"value\":\"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\",\"density\":3},\"tile\":{\"x\":\"repeat\",\"y\":\"mirror\"},\"alpha\":0.5}],\"foreground\":{\"source\":{\"type\":\"url\",\"value\":\"https://firebasestorage.googleapis.com/v0/b/deck-builder-1b711.appspot.com/o/bg-nav%202.png?alt=media&token=1f1acd39-f45d-49da-93f8-82a104451853\"},\"aspectRatio\":true}}}"
    private var dismissed = BehaviorRelay.createDefault(false)


    override fun getExpansionPreview(): Observable<ExpansionPreview> {
        return dismissed.switchMap {
            if (!it) {
                val preview = gson.fromJson(testingPreviewJson, ExpansionPreview::class.java)
                Observable.just(preview)
            } else {
                Observable.error(IOException("No preview found"))
            }
        }
    }

    override fun dismissPreview() {
        dismissed.accept(true)
    }
}